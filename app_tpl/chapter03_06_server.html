<!doctype html>
<html class="no-js">
    <head>
        include "head.html"
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="container">        

            include "header.html"

            <h2>Server tile</h2>

            <p>description here</p>

            <div id="map" class="map"></div>

            <h4 class="text-muted">Source code:</h4>
            <pre><code id="code_text" class="javascript"></code></pre>

            include "footer.html"

        </div>

        include "tail.html"

        include "ganalytics.html"

        <script id="code">
        var vectorSource = new ol.source.ServerVector({
            format: new ol.format.OSMXML(),
            loader: function(extent, resolution, projection) {
                var epsg4326Extent =
                    ol.proj.transformExtent(extent, projection, 'EPSG:4326');
                var url = 'http://overpass-api.de/api/xapi?map?bbox=' +
                    epsg4326Extent.join(',');
                $.ajax(url).then(function(response) {
                    vectorSource.addFeatures(vectorSource.readFeatures(response));
                });
            },
            strategy: ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({
                maxZoom: 19
            })),
            projection: 'EPSG:3857'
        });

            var map = new ol.Map({
                target: 'map',  // The DOM element that will contains the map
                renderer: 'canvas', // Force the renderer to be used
                layers: [
                    // Add a new Tile layer getting tiles from OpenStreetMap source
                    // new ol.layer.Tile({
                    //     source: new ol.source.OSM()
                    // }),
                    new ol.layer.Vector({
                        source: vectorSource
                        // new ol.source.OSMXML({
                        //     url: 'http://overpass-api.de/api/xapi'
                        // })
                    })
                ],
                // Create a view centered on the specified location and zoom level
                view: new ol.View({
                    center: ol.proj.transform([2.1833, 41.3833], 'EPSG:4326', 'EPSG:3857'),
                    zoom: 6
                })
                // view: new ol.View({
                //     center: [739218, 5906096],
                //     maxZoom: 19,
                //     zoom: 17
                //   })
            });
        </script>

        include "sourcecode.html"

    </body>
</html>
