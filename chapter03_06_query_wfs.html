<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <title>The Book of OpenLayers3 - Code samples</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
        <link rel="icon" href="favicon.ico" type="image/x-icon">

        <link rel="stylesheet" href="styles/7eab8598.vendor.css"/>

        <!-- bootswatch yeti theme -->
        <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/yeti/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="styles/3c6c5ed2.main.css"/>

        <!-- OpenLayers -->
        <link rel="stylesheet" href="http://ol3js.org/en/master/css/ol.css">
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="container">        

            <div class="header">
                <h1>The Book of OpenLayers3 <span class="text-muted">[Code samples]</span></h1>

                <p>These are the code samples for <a href="https://leanpub.com/thebookofopenlayers3">The Book of OpenLayer3</a>. Feel free to download the <a href="https://github.com/acanimal/thebookofopenlayers3">source code</a> and contribute to this <a href="https://github.com/acanimal/thebookofopenlayers3">repository</a>:</p>

                <div>
                    <iframe src="http://ghbtns.com/github-btn.html?user=acanimal&repo=thebookofopenlayers3&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>

                    <iframe src="http://ghbtns.com/github-btn.html?user=acanimal&repo=thebookofopenlayers3&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
                    
                    <iframe src="http://ghbtns.com/github-btn.html?user=acanimal&type=follow&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="130" height="20"></iframe>
                    
                    <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="thebookofopenlayers3">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                    <a href="https://twitter.com/acanimal" class="twitter-follow-button" data-show-count="false">Follow @acanimal</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                    <!-- Place this tag where you want the share button to render. -->
                    <div class="g-plus" data-action="share" data-annotation="bubble"></div>

                    <!-- Place this tag after the last share tag. -->
                    <script type="text/javascript">
                      (function() {
                        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                        po.src = 'https://apis.google.com/js/platform.js';
                        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                      })();
                    </script>
                </div>
            </div>

            <h2>Requesting a WFS server</h2>

            <p>This example shows how we can query a WFS server.</p>

            <p>The left map retrieves data in GeoJSON format and using JSONP technique. The right map retrieves data in WFS format using normal AJAX (this is possible because server accepts cross domain requests).</p>

            <p>The left map uses a <em>fixed</em> strategy, that means WFS is queried for a given bounding box and no more information is queried outside that box. The right map, uses a <code>ol.loadingstrategy.createTile</code> strategy which allows to query in a tiled way. </p>

            <div class="row">
                <div id="map" class="map col-sm-6"></div>
                <div id="mapJsonp" class="map col-sm-6"></div>
            </div>

            <h4 class="text-muted">Source code:</h4>
            <pre><code id="code_text" class="javascript"></code></pre>

            <div class="footer">
                <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Code samples for The Book of OpenLayers3</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/acanimal/thebookofopenlayers3" property="cc:attributionName" rel="cc:attributionURL">Antonio Santiago</a>. Licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
            </div>

        </div>

        <script src="scripts/705a441c.vendor.js"></script>

        <script src="scripts/c6b52431.plugins.js"></script>

        <!-- OpenLayers -->
        <script src="http://ol3js.org/en/master/build/ol-debug.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X');ga('send','pageview');
        </script>

        <script id="code">
            // Tiled layer
            var osmLayer = new ol.layer.Tile({
                source: new ol.source.OSM()
            });

            // Source retrieving WFS data in GML format using AJAX
            var vectorSource = new ol.source.ServerVector({
                format: new ol.format.WFS({
                    featureNS: 'http://openstreemap.org',
                    featureType: 'water_areas'
                }),
                loader: function(extent, resolution, projection) {
                    console.log('loader', arguments);
                    var server = 'http://demo.opengeo.org/geoserver/wfs?service=WFS&request=GetFeature&'+
                        'version=1.1.0&typename=osm:water_areas&';

                    var url = server + 
                        'srsname=EPSG:3857&bbox=' + extent.join(',');

                    $.ajax({
                        url: url
                    })
                    .done(function(response) {
                        vectorSource.addFeatures(vectorSource.readFeatures(response));
                    });
                },
                strategy: function() { 
                    return [ [-8473015.930372493, 5673984.22207263, -8430593.37967422, 5704559.033386701] ];
                },
                projection: 'EPSG:3857'
            });

            // Vector layer
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'green',
                        width: 2
                    })
                })
            });

            // Map
            var map = new ol.Map({
                target: 'map',
                renderer: 'canvas',
                layers: [osmLayer, vectorLayer],
                view: new ol.View({
                    center: ol.proj.transform([-75.923853, 45.428736], 'EPSG:4326', 'EPSG:3857'),
                    maxZoom: 19,
                    zoom: 11
                })
            });

            // Source retrieving WFS data in GeoJSON format using JSONP technique
            var vectorSourceJsonp = new ol.source.ServerVector({
                format: new ol.format.GeoJSON(),
                loader: function(extent, resolution, projection) {
                    var server = 'http://demo.opengeo.org/geoserver/wfs?service=WFS&request=GetFeature&'+
                        'version=1.1.0&typename=osm:water_areas&';

                    var url = server +
                        'outputFormat=text/javascript&'+
                        'format_options=callback:loadFeatures&' +
                        'srsname=EPSG:3857&bbox=' + extent.join(',');

                    $.ajax({
                        url: url,
                        dataType: 'jsonp'
                    });
                },
                strategy: ol.loadingstrategy.createTile(new ol.tilegrid.XYZ({
                    maxZoom: 19
                })),
                projection: 'EPSG:3857'
            });

            // Executed when data is loaded by the $.ajax method.
            var loadFeatures = function(response) {
                vectorSourceJsonp.addFeatures(vectorSourceJsonp.readFeatures(response));
            };

            // Vector layer
            var vectorLayerJsonp = new ol.layer.Vector({
                source: vectorSourceJsonp,
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'green',
                        width: 2
                    })
                })
            });

            // Map
            var mapJsonp = new ol.Map({
                target: 'mapJsonp',
                renderer: 'canvas',
                layers: [osmLayer, vectorLayerJsonp],
                view: new ol.View({
                    center: ol.proj.transform([-75.923853, 45.428736], 'EPSG:4326', 'EPSG:3857'),
                    maxZoom: 19,
                    zoom: 11
                })
            });
        </script>

        <script>
        	(function() {
        		$('#code_text').text( $('#code').text() );
            	hljs.initHighlightingOnLoad();
        	})();
        </script>

    </body>
</html>
